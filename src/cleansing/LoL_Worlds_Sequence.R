source("./SMARTDRAFT/src/packages/attach.packages.R");

for(i in 7:10)
{
  champions = FALSE; if(champions) {
    tmp = read_excel(paste0(getwd(), "/SMARTDRAFT/data/metadata/gamepedia/LoL_Worlds_PickBanHistory.xlsx"), sheet = i)[, c(15:20, 25:28, 1, 3:4, 6:7)]
  } else {tmp = read_excel(paste0(getwd(), "/SMARTDRAFT/data/metadata/gamepedia/LoL_Worlds_PickBanHistory.xlsx"), sheet = i)[, c(29:38, 1, 3:4, 6:7)][, c(c(1, 6, 7, 2, 3, 8, 9, 4, 5, 10), c(11:15))];}; rm(champions);

  if(i == 7) {worldsLoL = tmp; rm(tmp);} else {worldsLoL = rbind(worldsLoL, tmp); rm(tmp);}
  
}; rm(i); worldsLoL$Year <- as.numeric(worldsLoL$Year);

#################################################################################################################################################################################################################################################################################
## combinations #################################################################################################################################################################################################################################################################
#################################################################################################################################################################################################################################################################################

source("./SMARTDRAFT/src/support/build.sequence.R");
# Building the rules for each combination with relative attributes;
dtf_draftSequence <- get_Sequence(x = worldsLoL[, 1:10], gattr = worldsLoL[, 11:13], sattr = worldsLoL[, 14:15], snames = "Result", unique = TRUE); # rm(worldsLoL, worldsBLIND);

#################################################################################################################################################################################################################################################################################
## nodes ########################################################################################################################################################################################################################################################################
#################################################################################################################################################################################################################################################################################

nodes <- read_excel(paste0(getwd(), "/SMARTDRAFT/data/metadata/gamepedia/LoL_Worlds_PickBanHistory.xlsx"), sheet = 11);
nodes$Release <- as.numeric(gsub("\\-.*", "", as.character(nodes$Release))); nodes$Class <- as.factor(gsub("\\-.*", "", as.character(nodes$Class))); 

#################################################################################################################################################################################################################################################################################
## edges ########################################################################################################################################################################################################################################################################
#################################################################################################################################################################################################################################################################################

edges <- dtf_Combinations[, c(1:3, 6)] %>% 
  rename(from   = PickBLUE,
         to     = PickRED) %>%
  mutate(GROUP = paste0(from, "-", to)) %>%
  group_by(Year, GROUP) %>% 
  mutate(ResultBLUE  = ifelse(ResultBLUE == "Win", 1, 0),
         winrate     = sum(ResultBLUE)/n(),
         frequency   = n()) %>%
  ungroup() %>%
  select(-ResultBLUE, -GROUP) %>%
  group_by(Year) %>%
  mutate(weight = winrate * frequency/(n()/25)) %>%
  ungroup() %>%
  select(-frequency, -winrate); edges <- unique(na.omit(edges)); edges <- edges[, c(1, 2, 4, 3)]; rm(dtf_Combinations, worldsLoL);
  